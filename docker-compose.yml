# Â¿QuÃ©? Archivo de Docker Compose para orquestar servicios de desarrollo.
# Â¿Para quÃ©? Levantar PostgreSQL 17 con un solo comando, sin instalaciÃ³n local.
# Â¿Impacto? Garantiza que todos los desarrolladores usen la misma versiÃ³n de BD
#           con la misma configuraciÃ³n, eliminando el clÃ¡sico "en mi mÃ¡quina funciona".

services:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # ğŸ˜ PostgreSQL 17 â€” Base de datos principal
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  db:
    # Â¿QuÃ©? Imagen oficial de PostgreSQL 17 basada en Alpine Linux (mÃ¡s liviana).
    # Â¿Para quÃ©? Proveer la base de datos relacional del sistema de autenticaciÃ³n.
    # Â¿Impacto? Sin este servicio, el backend no puede persistir datos de usuarios ni tokens.
    image: postgres:17-alpine
    container_name: nn_auth_db
    restart: unless-stopped

    environment:
      # Variables que PostgreSQL usa al inicializar por primera vez el contenedor.
      # Estos valores son SOLO para desarrollo local â€” en producciÃ³n se usan secrets.
      POSTGRES_USER: nn_user
      POSTGRES_PASSWORD: nn_password
      POSTGRES_DB: nn_auth_db

    ports:
      # Â¿QuÃ©? Mapea el puerto 5432 del contenedor al 5432 del host.
      # Â¿Para quÃ©? Permitir que el backend (que corre fuera de Docker) se conecte a la BD.
      # Â¿Impacto? Si el puerto estÃ¡ ocupado, cambiar el lado izquierdo (ej: "5433:5432").
      - "5432:5432"

    volumes:
      # Â¿QuÃ©? Volumen nombrado que persiste los datos de PostgreSQL.
      # Â¿Para quÃ©? Que los datos sobrevivan al reinicio o recreaciÃ³n del contenedor.
      # Â¿Impacto? Sin volumen, cada `docker compose down` borrarÃ­a todos los datos.
      - nn_auth_data:/var/lib/postgresql/data

    healthcheck:
      # Â¿QuÃ©? Comando que Docker ejecuta periÃ³dicamente para verificar que PostgreSQL responde.
      # Â¿Para quÃ©? Saber si la BD estÃ¡ lista para aceptar conexiones antes de que el backend intente conectarse.
      # Â¿Impacto? Sin healthcheck, el backend podrÃ­a intentar conectarse antes de que la BD estÃ© lista.
      test: ["CMD-SHELL", "pg_isready -U nn_user -d nn_auth_db"]
      interval: 10s
      timeout: 5s
      retries: 5

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¦ VolÃºmenes nombrados
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
volumes:
  # Â¿QuÃ©? Volumen Docker nombrado para persistencia de datos de PostgreSQL.
  # Â¿Para quÃ©? Almacenar datos de la BD de forma durable entre reinicios del contenedor.
  # Â¿Impacto? Para borrar TODOS los datos: `docker compose down -v` (Â¡cuidado en producciÃ³n!).
  nn_auth_data:
